# ファイル別リファクタリング チェックリスト

このチェックリストは、各ファイルをリファクタリングする際の作業手順と品質確認項目です。

---

## 🔧 作業前準備

### Git 管理

- [ ] 作業ブランチの作成 `git checkout -b refactor/[対象ファイル名]`
- [ ] 現在の動作確認（手動テスト）
- [ ] 既存テストの実行確認

### 環境確認

- [ ] Docker 環境の起動確認
- [ ] 必要な依存関係の確認
- [ ] バックアップの作成（重要ファイルの場合）

---

## 📝 コメント・ドキュメント改善

### YARD 記法の統一

- [ ] クラスに YARD 形式の説明コメント追加
- [ ] 各メソッドに`@param`と`@return`を記述
- [ ] 複雑な処理に`@example`を追加
- [ ] 初学者向けの背景説明を`@note`で追加

### 日本語化チェック

- [ ] 英語コメントを日本語に変換
- [ ] 専門用語に読み方・意味を併記
- [ ] Rails 規約・慣習の説明を追加
- [ ] 「なぜこの実装なのか」の理由を明記

### サンプルコメント例

```ruby
# 温泉情報を管理するモデルクラス
#
# @note Active Recordパターンを使用し、データベースの`onsens`テーブルと1対1対応
# @note 位置情報検索や文字列検索など、複数の検索方法をサポート
# @example 基本的な使用例
#   onsen = Onsen.create(name: "玉造温泉", geo_lat: 35.4722, geo_lng: 133.0500)
#   nearby = Onsen.search(lat: 35.47, lng: 133.05, radius_km: 10)
class Onsen < ApplicationRecord
  # 温泉名を格納（必須・100文字以内）
  # @return [String] 温泉の正式名称
  validates :name, presence: true, length: { maximum: 100 }

  # 複合的な検索処理を実行
  # @param params [Hash] 検索条件のハッシュ
  # @option params [String] :q 名前・説明文での部分一致検索
  # @option params [String] :tags カンマ区切りのタグ検索
  # @option params [Float] :lat 緯度（位置検索時）
  # @option params [Float] :lng 経度（位置検索時）
  # @option params [Integer] :radius_km 検索半径（1-50km）
  # @return [ActiveRecord::Relation] 検索条件にマッチする温泉のコレクション
  # @note 位置検索は計算コストが高いため、事前に矩形範囲で絞り込み後に厳密計算
  def self.search(params)
    # 実装...
  end
end
```

---

## 🏗️ コード構造改善

### メソッド分割（1 メソッド 15 行以内目標）

- [ ] 長いメソッドを責務別に分割
- [ ] private メソッドの適切な抽出
- [ ] 意味のあるメソッド名に変更
- [ ] ネストの深さを 3 階層以内に制限

### 変数・定数の改善

- [ ] 意味の分かりやすい変数名に変更
- [ ] マジックナンバーを定数化
- [ ] 一時変数の適切な使用
- [ ] 条件式の明確化

### エラーハンドリング

- [ ] 適切な例外クラスの使用
- [ ] ユーザーフレンドリーなエラーメッセージ
- [ ] ログ出力の追加
- [ ] フォールバック処理の検討

---

## 🧪 テスト関連

### 既存テストの確認

- [ ] 関連するテストファイルの特定
- [ ] テストの実行と結果確認
- [ ] カバレッジの確認
- [ ] 不足しているテストケースの洗い出し

### 新規テスト追加（必要に応じて）

- [ ] 新しいメソッドのテスト追加
- [ ] エッジケースのテスト追加
- [ ] エラーケースのテスト追加
- [ ] 統合テストの確認

---

## 🎨 フロントエンド（該当する場合）

### ビューファイル改善

- [ ] パーシャルの適切な分割
- [ ] HTML の意味的マークアップ
- [ ] アクセシビリティ属性の追加
- [ ] レスポンシブ対応の確認

### Stimulus コントローラ

- [ ] 処理の段階的コメント追加
- [ ] エラーハンドリングの改善
- [ ] イベントリスナーの最適化
- [ ] デバッグ用ログの追加

### CSS/Tailwind

- [ ] 重複スタイルの共通化
- [ ] コンポーネント化の検討
- [ ] 命名規則の統一
- [ ] 不要なクラスの削除

---

## ✅ 完了チェック

### 機能テスト

- [ ] 主要機能の動作確認（手動）
- [ ] 自動テストの実行
- [ ] 異常系の動作確認
- [ ] 他機能への影響がないことを確認

### コード品質

- [ ] RuboCop の実行とエラー解消
- [ ] コメント充実度の確認
- [ ] メソッド・クラスサイズの確認
- [ ] 命名規則の統一確認

### ドキュメント更新

- [ ] 変更点の記録
- [ ] 関連ドキュメントの更新
- [ ] サンプルコードの更新
- [ ] 進捗追跡ファイルの更新

---

## 📋 完了後アクション

### Git 操作

- [ ] 変更内容のコミット（わかりやすいメッセージ）
- [ ] プッシュとプルリクエスト作成
- [ ] レビュー依頼（可能であれば）
- [ ] メインブランチへのマージ

### 進捗管理

- [ ] 進捗追跡ファイルの更新
- [ ] 学習ポイントの記録
- [ ] 課題・改善点の記録
- [ ] 次回作業の計画調整

### 学習記録

- [ ] 発見した技術的知見の記録
- [ ] 躓いたポイントと解決方法の記録
- [ ] 改善案や今後の課題の記録
- [ ] 初学者向けの追加説明が必要な箇所の記録

---

## 📖 参考資料

### 内部ドキュメント

- [実装ガイドライン](./implementation_guidelines.md)
- [システム設計書](./system_design.md)
- [UI/UX 仕様書](./ui_specification_tailwind.md)
- [リファクタリング計画書](./refactoring_plan.md)

### 外部参考資料

- [Rails ガイド](https://railsguides.jp/)
- [YARD ドキュメント](https://yardoc.org/)
- [RuboCop Rails](https://docs.rubocop.org/rubocop-rails/)
- [Hotwire 公式](https://hotwired.dev/)

---

_このチェックリストは作業ごとにコピーして使用してください_
_完了した項目は ✅ をつけて進捗を可視化しましょう_
